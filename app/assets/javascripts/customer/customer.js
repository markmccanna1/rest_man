// var FloorPlan = {
//   init: function(){
//     this.draw = SVG('floorplan').size('100%','100%')
//     this.tables = new Array()
//   }
// }

// var Table = {
//   init: function(id){
//     this.table = FloorPlan.draw.circle(100,100).attr({fill: 'white', class: 'table', id: 'table' + id})
//     this.table.stroke({color: 'black', width: 2})
//     this.table.draggable()
//     this.table.center('5%', '35%')
//     this.table.click(this.addClickEvent)
//     FloorPlan.tables.push(this)
//     this.chairs = new Array()
//     return this
//   },

//   addClickEvent: function(){
//     elementId = this.attr('id')
//     table = Table.getTableById(elementId)
//     console.log(elementId)
//     var idPat = /\d/
//     var dataTag = idPat.exec(elementId)[0]
//     console.log(dataTag[0])
//     var form = '<form action="/stream" method="post" id="check_in"> <input type="submit" value="Check In"> <input type="hidden" value="'+ elementId + '" name=example> </form>'
//     $('#header').append(form)
//     table.table.fill('black')
//     Table.table.click(null)
//   },

//   getTableById: function(id){
//     table = FloorPlan.tables.filter(function(element) {return element.table.attr('id') === id
//     })
//     return table[0]
//   }
// }

// $('document').ready(function() {
//    if ($('body.customer_profiles').length) {
//     console.log("Page generated by the customer controller.");
//   }
//   if($('#floorplan').length){
//     FloorPlan.init()
//     // Table.init(1)
//   }
// });

// init: function(){
//     window.setInterval(this.update, 5000)
//   },

//   update: function(){
//     $.get('/restaurant_profiles/carts', function(data){
//       var test = $.each(data, function(k,v) {
//         $.each(v, function(i, l){
//           $('.pending-carts').append('<li><a href="carts/' + l.id + '">' + l.id + '</a></li>')
//         })
//       })
//     })
//   }



function drawTable(positionX, positionY, height, width, htmlId) {
  this.positionX = positionX
  this.positionY = positionY
  this.height = height
  this.width = width
  this.htmlId = htmlId
  this.draw()
}

drawTable.prototype = {

  draw: function() {
    var nested = loadTables.drawing.nested()
    // nested.attr({id: 'svg_table' + id})
    this.drawing = nested.circle(this.width,this.height).attr({fill: 'white', class: 'table', id: this.htmlId})
    this.drawing.stroke({color: 'black', width: 2})
    this.drawing.draggable()
    this.drawing.center(this.positionX, this.positionY)
  }
}

function drawChair(positionX, positionY, height, width, htmlId) {
  this.positionX = positionX
  this.positionY = positionY
  this.height = height
  this.width = width
  this.htmlId = htmlId
  this.draw()
}

drawChair.prototype = {

  draw: function() {
  var nested = loadTables.drawing.nested()
  // nested.attr({id: 'svg_' + tableId + 'chair' + id})
  // var table = FloorPlan.getTableById(this.tableId)
  this.drawing = nested.rect(this.width, this.height).attr({class: 'chair', id: this.htmlId})
  this.drawing.move(this.positionX, this.positionY)
  }
}

var loadTables = {

  init: function(){
    window.setInterval(this.update, 5000)
  },

  update: function(){
    this.floorPlan = null
    //this request should take the id of the restaurant that you want to get information from,
    //for now the controller route will simply send back the correct data
    // $.get('/get_floor_plan', function(data) {
    //   console.log(2)
    //   loadTables.floorPlan = data
    //   console.log(data)
    //   console.log(loadTables.floorPlan)
    //   console.log(this)
    // })
    $.ajax({
      type: "GET",
      url: "/get_floor_plan",
      async: false,
      success: function(data){
        loadTables.floorPlan = data
        console.log(loadTables.floorPlan)
      }
    })
    this.drawPlan()
  },

  drawPlan: function(){
    this.drawing = SVG('get_floorplan').size('100%','100%')
    this.drawing.attr({id: 'floor'})
    this.drawing.stroke({color: 'black', width: 2})

    console.log(this)
    console.log(this.floorPlan)
    // this.tables = new Array()
    $.each(this.floorPlan, function(key, value) {
      console.log(value)
      $.each(value, function(tableId, tableValues){ 
        var id = tableId
        new drawTable(tableValues.positionX, tableValues.positionY, tableValues.width, tableValues.height, id) 
        $.each(tableValues.seats, function(seatId, seatValues){
          console.log(seatId)
          new drawChair(seatValues.positionX, seatValues.positionY, seatValues.width, seatValues.height, seatId)
        })
      })
      // value.position_x, value.position_y, value.width, value.height
      // new drawTable(value.position_x, value.position_y, value.width, value.height)
    })
    var chair = new drawChair(0,0,0,0,0)
    var table = new drawTable(0,0,0,0,0)
  }
}

$('document').ready(function() {
  if ($('body.restaurant_profiles').length) {
    console.log("Page generated by the restaurant controller.");
    //ajax request form hash of the floor 
    loadTables.update();
    // loadTables.drawPlan();
  }
});
